<!DOCTYPE html>
<html>
  <body>
    <h1>Zetrix Wallet Integration (TEST)</h1>

  </body>
  <script type="module">
    import ZetrixWalletConnect from "https://cdn.skypack.dev/zetrix-connect-wallet-sdk@1.1.3";
    
    const options = {
      bridge: 'wss://test-wscw.zetrix.com'
    }

    var zetrixConnect = new ZetrixWalletConnect({
      qrcode: false,
    });
    
    zetrixConnect.connect(options);
    
    const sign = (signMessage) => {
      document.getElementById("test3").innerHTML = "Signing Now";
      zetrixConnect.signMessage({ message: signMessage })
        .then((res) => {
          document.getElementById("test3").innerHTML = JSON.stringify(res);
          console.log(JSON.stringify(res));
        })
        .catch((e) => console.log('ERROR: ' + JSON.stringify(e)));
    };

    const test = () => {
      document.getElementById("test").innerHTML = "Calling Auth";
      zetrixConnect
        .auth()
        .then((res) => {
        //Flutter.postMessage(JSON.stringify(res));
        document.getElementById("test2").innerHTML = JSON.stringify(res);
        const walletAddress = res.data.address;
        preAuth(walletAddress);
      })
        .catch((e) => {
          console.log(e);
          document.getElementById("test2").innerHTML = JSON.stringify(e);
        });
    };
    
    const preAuth = (walletAddress) => {
      const url = 'https://ssivc-api-dev.myegdev.com/api/preauth';

      // Data to send with the POST request
      const data = {
        wallet_address: walletAddress,
        chainId: '2'
      };

      // Options for the POST request
      const options = {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      };

      // Make the POST request
      fetch(url, options)
        .then(response => response.json())
        .then(json => {
          console.log(JSON.stringify(json));
          sign(json.data.signMessage);
        })
        .catch(error => console.error(error));
    }
    
    signMessage.addEventListener('click', () => {
      sign();
      console.log('sign message clicked');
    });
    
    connectWallet.addEventListener('click', () => {
      test();
      console.log('connect wallet clicked');
    });
    
    setTimeout(test, 1000);

  </script>
  <span id="test">No Update</span
  ><br />
  <span id="test2">No Update</span>
  <br />
  <span id="test3">No Update</span>
  <br />
  <button id="signMessage">Sign</button>
  <br />
  <button id="connectWallet">Auth Wallet</button>
</html>
